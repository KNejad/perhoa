#!/usr/bin/env ruby

require 'socket'
require 'json'
require 'fileutils'
require 'time'
require 'yaml'
require 'pry' 
require_relative 'helper'

config = symbolizse(YAML.load_file(File.dirname(__FILE__) + '/config.yaml'))

if already_running? 
  if ARGV.include? '--daemon' or ARGV.length.zero?
    puts 'Perhoa is already running'
    exit
  end
  send_message
end

run_socket 

if ARGV.include? '--daemon' or config[:daemon]
  Process.daemon(true, false)
end

if config[:alarm][:enabled]
  alarm config[:alarm]
end


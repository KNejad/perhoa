#!/usr/bin/env ruby

require 'socket'
require 'json'
require 'fileutils'
require 'time'
require 'yaml'
require 'pry' 

require_relative 'helper'

config = symbolise(YAML.load_file(File.dirname(__FILE__) + '/config.yaml'))

if already_running? 
  if ARGV.include? '--daemon' or ARGV.length.zero?
    puts 'Perhoa is already running'
    exit
  end
  send_message
end


Process.daemon(true, false) if ARGV.include? '--daemon' or config[:daemon]

alarm config[:alarm] if config[:alarm][:enabled]

run_socket
